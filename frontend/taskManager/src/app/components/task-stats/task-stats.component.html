<div class="stats-container">
  <div class="stats-header">
    <h2>
      <i-feather name="bar-chart"></i-feather> Estadísticas de Tareas
    </h2>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="refreshStats()">
        <i-feather name="refresh-cw"></i-feather> Actualizar
      </button>
      <button class="btn btn-outline" (click)="goBack()">
        ← Volver a Tareas
      </button>
    </div>
  </div>

  <!-- Mensaje de error -->
  <div class="error-message" *ngIf="error">
    {{ error }}
  </div>

  <!-- Indicador de carga -->
  <div class="loading" *ngIf="loading">
    Cargando estadísticas...
  </div>

  <!-- Estadísticas -->
  <div class="stats-content" *ngIf="!loading && stats">
    <!-- Tipo de estadísticas -->
    <div class="stats-scope">
      <div class="scope-badge" [class.global]="stats.scope === 'global'" [class.personal]="stats.scope === 'personal'">
        <span *ngIf="stats.scope === 'global'">
          <i-feather name="globe"></i-feather> Estadísticas Globales (Administrador)
        </span>
        <span *ngIf="stats.scope === 'personal'">
          <i-feather name="user"></i-feather> Mis Estadísticas Personales
        </span>
      </div>
    </div>

    <!-- Cards de estadísticas -->
    <div class="stats-grid">
      <!-- Total de tareas -->
      <div class="stats-card total">
        <div class="stats-icon"><i-feather name="list"></i-feather></div>
        <div class="stats-info">
          <h3>{{ stats.total_tasks }}</h3>
          <p>Tareas Totales</p>
        </div>
      </div>

      <!-- Tareas completadas -->
      <div class="stats-card completed">
        <div class="stats-icon">
          <i-feather name="check-square"></i-feather>
        </div>
        <div class="stats-info">
          <h3>{{ stats.completed_tasks }}</h3>
          <p>Completadas</p>
        </div>
      </div>

      <!-- Tareas pendientes -->
      <div class="stats-card pending">
        <div class="stats-icon">
          <i-feather name="clock"></i-feather>
        </div>
        <div class="stats-info">
          <h3>{{ stats.pending_tasks }}</h3>
          <p>Pendientes</p>
        </div>
      </div>

      <!-- Porcentaje de completación -->
      <div class="stats-card completion">
        <div class="stats-icon">
          <i-feather name="trending-up"></i-feather>
        </div>
        <div class="stats-info">
          <h3>{{ stats.completion_rate | number:'1.1-1' }}%</h3>
          <p>Completación</p>
        </div>
      </div>
    </div>

    <!-- Barra de progreso visual -->
    <div class="progress-section">
      <h4>Progreso de Completación</h4>
      <div class="progress-bar" *ngIf="stats">
        <div
          class="progress-fill"
          [style.width.%]="stats.completion_rate"
          [class.high]="stats.completion_rate >= 80"
          [class.medium]="stats.completion_rate >= 50 && stats.completion_rate < 80"
          [class.low]="stats.completion_rate < 50"
        ></div>
      </div>
      <div class="progress-labels" *ngIf="stats">
        <span>0%</span>
        <span>{{ stats.completion_rate | number:'1.1-1' }}%</span>
        <span>100%</span>
      </div>
    </div>

    <!-- Resumen textual -->
    <div class="stats-summary" *ngIf="stats">
      <div class="summary-card">
        <h4>Resumen</h4>
        <p *ngIf="stats.total_tasks === 0">
          <span *ngIf="stats.scope === 'personal'">No tienes tareas creadas aún.</span>
          <span *ngIf="stats.scope === 'global'">No hay tareas en el sistema aún.</span>
        </p>
        <div *ngIf="stats.total_tasks > 0">
          <p *ngIf="stats.scope === 'personal'">
            Tienes <strong>{{ stats.total_tasks }}</strong> tarea<span *ngIf="stats.total_tasks !== 1">s</span>
            en total, de las cuales <strong>{{ stats.completed_tasks }}</strong>
            <span *ngIf="stats.completed_tasks === 1">está completada</span>
            <span *ngIf="stats.completed_tasks !== 1">están completadas</span>.
          </p>
          <p *ngIf="stats.scope === 'global'">
            El sistema tiene <strong>{{ stats.total_tasks }}</strong> tarea<span *ngIf="stats.total_tasks !== 1">s</span>
            en total, de las cuales <strong>{{ stats.completed_tasks }}</strong>
            <span *ngIf="stats.completed_tasks === 1">está completada</span>
            <span *ngIf="stats.completed_tasks !== 1">están completadas</span>.
          </p>

          <p *ngIf="stats.completion_rate >= 80" class="positive">
            ¡Excelente progreso! <i-feather name="award"></i-feather>
          </p>
          <p *ngIf="stats.completion_rate >= 50 && stats.completion_rate < 80" class="neutral">
            Buen avance, ¡sigue así! <i-feather name="smile"></i-feather>
          </p>
          <p *ngIf="stats.completion_rate < 50 && stats.total_tasks > 0" class="encouraging">
            Hay varias tareas pendientes, ¡puedes hacerlo!
          </p>
        </div>
      </div>
    </div>

    <!-- Información del usuario actual -->
    <div class="user-info" *ngIf="currentUser">
      <small>
        Estadísticas para: <strong>{{ currentUser.full_name || currentUser.username }}</strong>
        <span *ngIf="currentUser.is_admin"> (Administrador)</span>
      </small>
    </div>
  </div>
</div>
